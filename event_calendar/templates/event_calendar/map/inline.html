{% load i18n markup thumbnail humanize sekizai_tags %}

<div id="event_map" class="event_map">
    (( loading ))
</div>


{% addtoblock "js-ext" %}<script src="https://maps.googleapis.com/maps/api/js"></script>{% endaddtoblock %}
{% addtoblock "js-ext" %}<script src="{{ STATIC_URL }}event_calendar/js/map/map.ext.infobox.js"></script>{% endaddtoblock %}
{% addtoblock "js-ext" %}<script src="{{ STATIC_URL }}event_calendar/js/map/map.ext.markerwithlabel2.js"></script>{% endaddtoblock %}
{% comment %}{% addtoblock "js-ext" %}<script src="{{ STATIC_URL }}event_calendar/js/map/tile.stamen-1.3.0.js"></script>{% endaddtoblock %}{% endcomment %}
{% addtoblock "js-ext" %}<script src="{{ STATIC_URL }}event_calendar/js/map/markerclusterer-1.0.1.js"></script>{% endaddtoblock %}

{% addtoblock "js-post" %}<script src="{{ STATIC_URL }}event_calendar/js/map/base.js"></script>{% endaddtoblock %}




{% addtoblock "js-post" %}
    <script>
        $(function () {
            // douple callback. not sure if this is a good idea...
            google.maps.event.addDomListener(window, 'load', init_map);
        });

        function init_map() {

            var map = new MapUI();
            map.target_id = 'event_map';

            var markers = [];
            {% comment %}{% for object in object_list %}{% endcomment %}
                {% if object.coordinates %}
                markers.push({
                    id: {{ object.pk }},
                    name: '{{ object.title }}',
                    city: '{{ object.city }}',
                    image: '{% thumbnail object.key_image 300x220 crop upscale %}',
                    link: '{{ object.get_absolute_url }}',
                    lat: parseFloat('{{ object.coordinates.latitude }}'.replace(',', '.')),
                    lng: parseFloat('{{ object.coordinates.longitude }}'.replace(',', '.'))
                })
                {% endif %}
            {% comment %}{% endfor %}{% endcomment %}


            map.markers = markers;
            map.marker_image = '{{ STATIC_URL }}event_calendar/img/map/marker.base.svg';
            map.init();
            map.draw_markers();
            map.set_bounds();


            /*
            var mapOptions = {
                center: { lat: 47.3667, lng: 8.5500},
                zoom: 12,
                styles: mapStyle
            };
            var map = new google.maps.Map(document.getElementById('event_map'), mapOptions);
            */
        }


    </script>
{% endaddtoblock %}

{% addtoblock "css" %}
    <style>

        #event_map {
            min-height:  400px;
        }
        #event_map .gmnoprint img {
            max-width: 80px;
        }

        .infoBox {
            padding: 0px;
            min-width: 200px;
            background: white;
            background: #1E67FA;
            box-shadow: 2px 2px 5px 2px rgba(0, 0, 0, 0.3)
        }

        .infoBox .wrap {
            padding: 10px;
            min-height: 90px;
            background-size: 130px 90px;
            background-repeat: no-repeat;
            padding-left: 140px;
            color: white !important;
        }

        .infoBox .wrap h1, .infoBox .wrap h2 {
            color: white !important;
            white-space: nowrap;
        }


    </style>
{% endaddtoblock %}







{% addtoblock "js-post" %}
    <script>
        mapStyle = [
    {
        "featureType": "water",
        "elementType": "all",
        "stylers": [
            {
                "visibility": "simplified"
            },
            {
                "hue": "#e9ebed"
            },
            {
                "saturation": -78
            },
            {
                "lightness": 67
            }
        ]
    },
    {
        "featureType": "landscape",
        "elementType": "all",
        "stylers": [
            {
                "visibility": "simplified"
            },
            {
                "hue": "#ffffff"
            },
            {
                "saturation": -100
            },
            {
                "lightness": 100
            }
        ]
    },
    {
        "featureType": "road",
        "elementType": "geometry",
        "stylers": [
            {
                "visibility": "simplified"
            },
            {
                "hue": "#bbc0c4"
            },
            {
                "saturation": -93
            },
            {
                "lightness": 31
            }
        ]
    },
    {
        "featureType": "poi",
        "elementType": "all",
        "stylers": [
            {
                "visibility": "off"
            },
            {
                "hue": "#ffffff"
            },
            {
                "saturation": -100
            },
            {
                "lightness": 100
            }
        ]
    },
    {
        "featureType": "road.local",
        "elementType": "geometry",
        "stylers": [
            {
                "visibility": "simplified"
            },
            {
                "hue": "#e9ebed"
            },
            {
                "saturation": -90
            },
            {
                "lightness": -8
            }
        ]
    },
    {
        "featureType": "transit",
        "elementType": "all",
        "stylers": [
            {
                "visibility": "on"
            },
            {
                "hue": "#e9ebed"
            },
            {
                "saturation": 10
            },
            {
                "lightness": 69
            }
        ]
    },
    {
        "featureType": "administrative.locality",
        "elementType": "all",
        "stylers": [
            {
                "visibility": "on"
            },
            {
                "hue": "#2c2e33"
            },
            {
                "saturation": 7
            },
            {
                "lightness": 19
            }
        ]
    },
    {
        "featureType": "road",
        "elementType": "labels",
        "stylers": [
            {
                "visibility": "on"
            },
            {
                "hue": "#bbc0c4"
            },
            {
                "saturation": -93
            },
            {
                "lightness": 31
            }
        ]
    },
    {
        "featureType": "road.arterial",
        "elementType": "labels",
        "stylers": [
            {
                "visibility": "simplified"
            },
            {
                "hue": "#bbc0c4"
            },
            {
                "saturation": -93
            },
            {
                "lightness": -2
            }
        ]
    }
]						;
    </script>
{% endaddtoblock %}